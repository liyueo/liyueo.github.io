---
layout:     post
title:      grpc
subtitle:   grpc-20240506
date:       2024-05-06
author:     BY
header-img: img/wallhaven-mario.jpg
catalog: true
tags:
    - grpc
    - protobuf
---


### 1、protoc编译命令

```bash
protoc -I=. --grpc_out=. --cpp_out=. --plugin=protoc-gen-grpc=/usr/local/bin/grpc_cpp_plugin demo.proto
```
生成文件
demo.grpc.pb.cc
demo.grpc.pb.h
demo.pb.cc
demo.pb.h

指定 --grpc_out 会多生成 有关grpc的文件

### 2、四种通信方式，四种数据流
1.简单模式 一元rpc
这种模式最为传统,即客户端发起一次请求,服务端响应一个数据,这和大家平时熟悉的rpc没什么区别,所以不在详细介绍

2.服务端数据流模式
这种模式是客户端发起一次请求，服务端返回一段连续的数据流。典型的例子是客户端向服务端发送一个股票代码，服务端就把该股票的实时数据源源不断的返回给客户端。


3.客户端数据流模式
与服务端数据流模式相反，这次是客户端源源不断的向服务端发送数据流，而在发送结束后，由服务端返回一个响应。典型的例子是物联网向服务器报送数据。
```proto
syntax = "proto3";

package example;

// 定义请求和响应消息类型
message ClientStreamingRequest {
  string data = 1;
}

message ClientStreamingResponse {
  string data = 1;
}

// 定义服务
service ClientStreamingService {
  // 定义客户端流 RPC
  rpc ClientStreamingMethod(stream ClientStreamingRequest) returns (ClientStreamingResponse);
}
```


4.双向数据流模式
顾名思义，这是客户端和服务端都可以向对方发送数据流，这个时候双方的数据可以同时互相发送，也就是可以实现实时交互。典型的例子是聊天机器人。

示例代码：
https://kimi.moonshot.cn/share/cosu6kcudu66rig88mlg


## 面试常问问题，，
1. gRPC四种通信模式
    一元RPC、客户端数据流、服务端数据流、双向数据流
2. KeepAlived发送的是什么HTTP2帧
    ping帧，，基于ICMP 全称是 Internet Control Message Protocol，也就是互联网控制报文协议
3. KeepAlived是针对Connection 还是 Stream
    针对Connection
4. HTTP2有哪些类型帧，各有什么作用
    10种帧类型，总体分为数据帧和控制帧
   数据帧有三种，，Data、Header、priority。。
   控制帧有7种，RST_Stream、Ping、Push_Promise、Settings、Window_update、Goaway、Continuation         
6. 什么是拦截器，拦截器有什么作用
    类似于中间件、有客户端拦截器和服务端拦截器，，服务端拦截器是在rpc请求到达要请求的函数之前执行的操作，，比如：身份验证、流量限制、日志追踪、**代理转发**
    客户端拦截器：a）请求日志记录及监控；b）添加请求头数据、以便代理转发使用；c)请求或者结果重写
8. 什么是Resolver，常见有哪些
    名称解析。gRPC的解析器（Name Resolver）是一个在gRPC中用于将服务名称解析为对应的后端IP地址和端口号的组件。解析器在客户端建立连接时使用，负责将逻辑服务名称解析为具体的服务器地址，从而允许客户     端连接到正确的服务器
9. 什么是Balance，常见有哪些
    在这：https://www.cnblogs.com/Mcoming/p/18080584
10. Resolver 与 Balance 关系
11. 健康检查状态有哪些
12. 健康检查失败是阻塞 还是 返回失败
13. 什么是连接的fast fail
14. 失败重试的策略有哪些，各有什么特点
15. 限制重试策略是什么，什么是Pushback
16. 什么是多路复用，为什么gRPC能支持多路复用
17. gRPC、HTTP2、Stream 之间的关系是什么
18. gRPC流量控制策略有哪些，各有什么特点，有什么差别
19. gRPC高性能的原因是什么
20. gRPC调试、监控方法有哪些
21. 什么是metadata，客户端、服务端能够携带metadata的帧有哪些
20.简述从客户端创建Stream 到 调用远程服务结束、关闭Stream的流程
22. gRPC 默认是否有压缩算法，系统默认支持哪些压缩算法，压缩算法的配置受到哪些因素影响
23. connection有哪些状态
23.如何能够获取服务端的Service List、File Descriptor等
24.健康检查服务端是否要重新定义proto文件、定义远程方法
25. 健康检查与负载均衡策略的关系？默认的负载均衡策略可否应用健康检查
26. Stream的Send方法是否线程安全，Stream的Send方法与Recv方法是否协程安全？
27. 简述Stream流量控制，客户端与服务端完整处理流程，包括配额管理
28. 当connection中断后，如何确定连接已经建立完成 再调用远程服务？
29. 什么是HEADERS TRAILER 帧，什么时候回发送该帧
30. 客户端与服务端如何同步压缩算法
31. 客户端与服务端发送http帧之前需要经过哪些处理（controlbuf）
32. 如何配置gRPC TLS 双向认证
33. 客户端TLS Config 中Service Name 有什么作用
34. GOAWAY帧由谁发起，什么含义
35. Backoff是什么，有哪些模块处理使用Backoff
36. connection 创建及失败重连流程
37. RPC调用失败的三种情况
38. BinaryLog日志作用
39. 客户端建立connection全流程
40. gRPC是否实现连接池，为什么？
教程不涉及的问题：
41. 你在使用gRPC遇到的问题？
42. 在解决实际问题中做过哪些优化？
43.用过哪些gRPC生态组件？
